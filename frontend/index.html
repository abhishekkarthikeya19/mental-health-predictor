<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Mental Health Predictor - Analyze text for signs of mental distress">
  <meta name="theme-color" content="#3498db">
  <title>Mental Health Predictor</title>
  <style>
    :root {
      --primary-color: #3498db;
      --primary-dark: #2980b9;
      --success-bg: #d4edda;
      --success-text: #155724;
      --danger-bg: #f8d7da;
      --danger-text: #721c24;
      --neutral-bg: #f5f5f5;
      --neutral-text: #333;
      --light-border: #ddd;
      --disabled-bg: #95a5a6;
      --box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      --focus-shadow: 0 0 0 3px rgba(52, 152, 219, 0.3);
    }

    /* Base styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: var(--neutral-bg);
      color: var(--neutral-text);
      line-height: 1.6;
    }

    .container {
      background-color: white;
      border-radius: 8px;
      padding: 30px;
      box-shadow: var(--box-shadow);
    }

    h1 {
      color: #2c3e50;
      text-align: center;
      margin-bottom: 30px;
    }

    /* Form elements */
    .input-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .character-counter {
      display: block;
      text-align: right;
      font-size: 14px;
      color: #666;
      margin-top: 5px;
    }

    textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--light-border);
      border-radius: 4px;
      font-size: 16px;
      min-height: 120px;
      font-family: inherit;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: var(--focus-shadow);
    }

    .button-group {
      display: flex;
      gap: 10px;
    }

    button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s, transform 0.1s;
      flex: 1;
    }

    button:hover {
      background-color: var(--primary-dark);
    }

    button:active {
      transform: translateY(1px);
    }

    button:focus {
      outline: none;
      box-shadow: var(--focus-shadow);
    }

    button:disabled {
      background-color: var(--disabled-bg);
      cursor: not-allowed;
      transform: none;
    }

    button.secondary {
      background-color: #e9e9e9;
      color: #333;
    }

    button.secondary:hover {
      background-color: #d9d9d9;
    }

    /* Results and status elements */
    .result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 4px;
      font-weight: 500;
      text-align: center;
      font-size: 18px;
      white-space: pre-line;
      line-height: 1.5;
      transition: all 0.3s ease;
    }

    .normal {
      background-color: var(--success-bg);
      color: var(--success-text);
    }

    .distressed {
      background-color: var(--danger-bg);
      color: var(--danger-text);
    }

    .loading {
      display: none;
      text-align: center;
      margin-top: 20px;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid var(--primary-color);
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 2s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .error {
      color: var(--danger-text);
      background-color: var(--danger-bg);
      padding: 10px;
      border-radius: 4px;
      margin-top: 10px;
      display: none;
    }

    /* History section */
    .history-section {
      margin-top: 30px;
      display: none;
    }

    .history-section h2 {
      font-size: 1.2rem;
      margin-bottom: 15px;
      color: #2c3e50;
    }

    .history-list {
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid var(--light-border);
      border-radius: 4px;
    }

    .history-item {
      padding: 10px;
      border-bottom: 1px solid var(--light-border);
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .history-item:last-child {
      border-bottom: none;
    }

    .history-item:hover {
      background-color: #f0f0f0;
    }

    .history-item .timestamp {
      font-size: 0.8rem;
      color: #666;
    }

    .history-item .preview {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Footer */
    .footer {
      margin-top: 30px;
      text-align: center;
      font-size: 0.9rem;
      color: #666;
    }

    .footer a {
      color: var(--primary-color);
      text-decoration: none;
    }

    .footer a:hover {
      text-decoration: underline;
    }

    /* Disclaimer */
    .disclaimer {
      margin-top: 20px;
      padding: 15px;
      background-color: #f8f9fa;
      border-left: 4px solid #6c757d;
      font-size: 0.9rem;
      color: #495057;
    }

    /* Responsive design */
    @media (max-width: 600px) {
      .container {
        padding: 20px;
      }

      h1 {
        font-size: 1.5rem;
      }

      .button-group {
        flex-direction: column;
      }
    }

    /* Accessibility improvements */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }

    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      :root {
        --neutral-bg: #121212;
        --neutral-text: #e0e0e0;
        --light-border: #444;
        --box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      body {
        background-color: var(--neutral-bg);
        color: var(--neutral-text);
      }

      .container {
        background-color: #1e1e1e;
      }

      h1 {
        color: #e0e0e0;
      }

      textarea {
        background-color: #2d2d2d;
        color: #e0e0e0;
        border-color: #444;
      }

      .character-counter {
        color: #aaa;
      }

      button.secondary {
        background-color: #3d3d3d;
        color: #e0e0e0;
      }

      button.secondary:hover {
        background-color: #4d4d4d;
      }

      .history-item:hover {
        background-color: #2a2a2a;
      }

      .disclaimer {
        background-color: #2a2a2a;
        border-left-color: #6c757d;
        color: #adb5bd;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Mental Health Prediction</h1>
    
    <div class="input-group">
      <label for="text_input">How are you feeling?</label>
      <textarea 
        id="text_input" 
        placeholder="Describe how you're feeling or what's on your mind..." 
        aria-describedby="text_input_help"
        maxlength="5000"
        aria-required="true"
      ></textarea>
      <span id="text_input_help" class="character-counter">0/5000 characters</span>
    </div>
    
    <div class="button-group">
      <button 
        id="predict_button" 
        onclick="predict()" 
        aria-label="Analyze text for mental health indicators"
      >
        Analyze Text
      </button>
      <button 
        id="clear_button" 
        onclick="clearForm()" 
        class="secondary"
        aria-label="Clear form and results"
      >
        Clear
      </button>
    </div>
    
    <div id="error" class="error" role="alert">Please enter some text to analyze.</div>
    
    <div id="loading" class="loading" aria-live="polite">
      <div class="spinner" aria-hidden="true"></div>
      <p>Analyzing your text...</p>
    </div>
    
    <div id="result" class="result" style="display: none;" aria-live="polite"></div>
    
    <div id="history_section" class="history-section">
      <h2>Previous Analyses</h2>
      <div id="history_list" class="history-list"></div>
    </div>
    
    <div class="disclaimer">
      <strong>Disclaimer:</strong> This tool is for educational purposes only and is not a substitute for professional mental health advice. If you or someone you know is experiencing a mental health crisis, please contact a mental health professional or a crisis helpline immediately.
    </div>
  </div>
  
  <div class="footer">
    <p>Mental Health Predictor &copy; 2023 | <a href="#" onclick="toggleHistory()">View History</a></p>
  </div>

  <script>
    // Configuration
    const API_CONFIG = {
      baseUrl: window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
        ? 'http://localhost:8000' 
        : 'https://your-production-api.com',
      endpoints: {
        predict: '/predict/'
      }
    };
    
    // DOM Elements
    const elements = {
      textInput: document.getElementById('text_input'),
      predictButton: document.getElementById('predict_button'),
      clearButton: document.getElementById('clear_button'),
      loadingElement: document.getElementById('loading'),
      resultElement: document.getElementById('result'),
      errorElement: document.getElementById('error'),
      characterCounter: document.getElementById('text_input_help'),
      historySection: document.getElementById('history_section'),
      historyList: document.getElementById('history_list')
    };
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      // Load history from localStorage
      loadHistory();
      
      // Set up character counter
      updateCharacterCount();
      
      // Add event listeners
      elements.textInput.addEventListener('input', updateCharacterCount);
      elements.textInput.addEventListener('keypress', handleKeyPress);
      
      // Check for saved draft
      const savedDraft = localStorage.getItem('mental_health_predictor_draft');
      if (savedDraft) {
        elements.textInput.value = savedDraft;
        updateCharacterCount();
      }
      
      // Auto-save draft as user types
      elements.textInput.addEventListener('input', () => {
        localStorage.setItem('mental_health_predictor_draft', elements.textInput.value);
      });
    });
    
    // Update character count
    function updateCharacterCount() {
      const currentLength = elements.textInput.value.length;
      const maxLength = elements.textInput.getAttribute('maxlength');
      elements.characterCounter.textContent = `${currentLength}/${maxLength} characters`;
      
      // Visual feedback as user approaches limit
      if (currentLength > maxLength * 0.9) {
        elements.characterCounter.style.color = '#e74c3c';
      } else {
        elements.characterCounter.style.color = '';
      }
    }
    
    // Handle Enter key press
    function handleKeyPress(event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        predict();
      }
    }
    
    // Clear form and results
    function clearForm() {
      elements.textInput.value = '';
      elements.resultElement.style.display = 'none';
      elements.errorElement.style.display = 'none';
      updateCharacterCount();
      localStorage.removeItem('mental_health_predictor_draft');
      elements.textInput.focus();
    }
    
    // Toggle history section
    function toggleHistory() {
      const isVisible = elements.historySection.style.display === 'block';
      elements.historySection.style.display = isVisible ? 'none' : 'block';
      loadHistory();
      return false; // Prevent default link behavior
    }
    
    // Load analysis history from localStorage
    function loadHistory() {
      const history = JSON.parse(localStorage.getItem('mental_health_predictor_history') || '[]');
      
      if (history.length === 0) {
        elements.historyList.innerHTML = '<div class="history-item">No previous analyses found.</div>';
        return;
      }
      
      elements.historyList.innerHTML = '';
      
      // Sort by timestamp (newest first)
      history.sort((a, b) => b.timestamp - a.timestamp);
      
      // Display history items
      history.forEach(item => {
        const date = new Date(item.timestamp);
        const formattedDate = date.toLocaleString();
        
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';
        historyItem.innerHTML = `
          <div class="timestamp">${formattedDate}</div>
          <div class="preview">${item.text.substring(0, 50)}${item.text.length > 50 ? '...' : ''}</div>
        `;
        
        // Click to load this analysis
        historyItem.addEventListener('click', () => {
          elements.textInput.value = item.text;
          updateCharacterCount();
          elements.resultElement.textContent = item.result;
          elements.resultElement.className = item.prediction ? 'result distressed' : 'result normal';
          elements.resultElement.style.display = 'block';
          elements.historySection.style.display = 'none';
          window.scrollTo(0, 0);
        });
        
        elements.historyList.appendChild(historyItem);
      });
    }
    
    // Save analysis to history
    function saveToHistory(text, prediction, result) {
      const history = JSON.parse(localStorage.getItem('mental_health_predictor_history') || '[]');
      
      // Add new item
      history.push({
        text,
        prediction,
        result,
        timestamp: Date.now()
      });
      
      // Keep only the most recent 10 items
      if (history.length > 10) {
        history.sort((a, b) => b.timestamp - a.timestamp);
        history.splice(10);
      }
      
      localStorage.setItem('mental_health_predictor_history', JSON.stringify(history));
    }
    
    // Main prediction function
    async function predict() {
      const text = elements.textInput.value.trim();
      
      // Validate input
      if (!text) {
        elements.errorElement.textContent = 'Please enter some text to analyze.';
        elements.errorElement.style.display = 'block';
        elements.textInput.focus();
        return;
      }
      
      if (text.length < 10) {
        elements.errorElement.textContent = 'Please enter at least 10 characters for a meaningful analysis.';
        elements.errorElement.style.display = 'block';
        return;
      }
      
      elements.errorElement.style.display = 'none';
      
      // Show loading state
      elements.predictButton.disabled = true;
      elements.clearButton.disabled = true;
      elements.loadingElement.style.display = 'block';
      elements.resultElement.style.display = 'none';
      
      try {
        const response = await fetch(`${API_CONFIG.baseUrl}${API_CONFIG.endpoints.predict}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text_input: text })
        });
        
        if (!response.ok) {
          const errorData = await response.json().catch(() => ({}));
          throw new Error(errorData.detail || `API request failed with status ${response.status}`);
        }
        
        const data = await response.json();
        
        // Display result with appropriate styling
        let resultText = data.prediction ? 
          'Analysis Result: Potential signs of distress detected' : 
          'Analysis Result: No significant signs of distress detected';
          
        // Add confidence score if available
        if (data.confidence !== undefined) {
          const confidencePercent = Math.round(data.confidence * 100);
          resultText += ` (Confidence: ${confidencePercent}%)`;
        }
        
        // Add recommendation if available
        if (data.recommendation) {
          resultText += `\n\n${data.recommendation}`;
        }
        
        elements.resultElement.textContent = resultText;
        elements.resultElement.className = data.prediction ? 'result distressed' : 'result normal';
        elements.resultElement.style.display = 'block';
        
        // Save to history
        saveToHistory(text, data.prediction, resultText);
        
        // Clear draft since we've successfully analyzed it
        localStorage.removeItem('mental_health_predictor_draft');
      } catch (error) {
        console.error('Error:', error);
        elements.errorElement.textContent = error.message || 'An error occurred while analyzing the text. Please try again.';
        elements.errorElement.style.display = 'block';
      } finally {
        // Hide loading state
        elements.loadingElement.style.display = 'none';
        elements.predictButton.disabled = false;
        elements.clearButton.disabled = false;
      }
    }
  </script>
</body>
</html>
